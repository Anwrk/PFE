<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬</title>
    <style>
        .question-box {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 15px;
            position: relative;
        }
        .remove-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 5px 8px;
            cursor: pointer;
        }
        button {
            padding: 6px 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯</h1>

<form method="post">
    {% csrf_token %}

    <fieldset>
        <legend><strong>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</strong></legend>
        {{ form_form.as_p }}
    </fieldset>

    <fieldset id="questions">
        <legend><strong>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</strong></legend>
        <p><em>Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§ÙƒØªØ¨ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠÙ‡ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª.</em></p>

        {{ formset.management_form }}

        {% for form in formset %}
            <div class="question-box">
                <button type="button" class="remove-btn" onclick="removeQuestion(this)">âœ–</button>
                {{ form.as_p }}
            </div>
        {% endfor %}
    </fieldset>

    <button type="button" onclick="addQuestion()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button><br><br>
    <button type="submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
</form>

<script>
    function addQuestion() {
        const totalForms = document.getElementById('id_question_set-TOTAL_FORMS');
        const currentFormCount = parseInt(totalForms.value);
        const questionsDiv = document.getElementById('questions');
        const emptyFormHtml = `{{ formset.empty_form.as_p|escapejs }}`;
        const newFormHtml = emptyFormHtml.replace(/__prefix__/g, currentFormCount);

        const div = document.createElement('div');
        div.classList.add('question-box');
        div.innerHTML = `<button type="button" class="remove-btn" onclick="removeQuestion(this)">âœ–</button>` + newFormHtml;
        questionsDiv.appendChild(div);

        totalForms.value = currentFormCount + 1;
    }

    function removeQuestion(button) {
        const box = button.closest('.question-box');
        box.remove();

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù:
        const totalForms = document.getElementById('id_question_set-TOTAL_FORMS');
        const allBoxes = document.querySelectorAll('.question-box');
        totalForms.value = allBoxes.length;

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙˆÙ„ (Ø¹Ø´Ø§Ù† Django ÙŠØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡Ù…):
        allBoxes.forEach((box, index) => {
            box.querySelectorAll('input, select, textarea').forEach(el => {
                if (el.name) el.name = el.name.replace(/question_set-\d+-/, `question_set-${index}-`);
                if (el.id) el.id = el.id.replace(/question_set-\d+-/, `question_set-${index}-`);
            });
        });
    }
</script>

</body>
</html>
